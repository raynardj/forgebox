---

title: Title

keywords: fastai
sidebar: home_sidebar

summary: "summary"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/15_loopstack.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    {% raw %}
        
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="15-LoopStack">15 LoopStack<a class="anchor-link" href="#15-LoopStack">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To run through iterations quickly, we use the california housing data</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets.california_housing</span> <span class="kn">import</span> <span class="n">fetch_california_housing</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">fetch_california_housing</span><span class="p">(</span><span class="n">return_X_y</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((20640, 8), (20640,))</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Normalized Data</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Preview x input</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">s</span><span class="p">):</span> <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="n">s</span>
<span class="k">def</span> <span class="nf">denorm</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">s</span><span class="p">):</span> <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">s</span><span class="p">)</span><span class="o">+</span><span class="n">m</span>

<span class="n">x_normed</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">0</span><span class="p">))(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y_normed</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="n">y</span><span class="o">.</span><span class="n">std</span><span class="p">())(</span><span class="n">y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x_normed</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">),</span><span class="n">x_normed</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>\
<span class="n">y_normed</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">),</span><span class="n">y_normed</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(array([ 0.,  0.,  0., -0., -0.,  0., -0., -0.], dtype=float16),
 array([1., 1., 1., 1., 1., 1., 1., 1.]),
 0.0,
 1.0)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">x_normed</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span><span class="mi">10</span><span class="p">)])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.image.AxesImage at 0x1a187a8110&gt;</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x_normed</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[ 2.34476576,  0.98214266,  0.62855945, ..., -0.04959654,
         1.05254828, -1.32783522],
       [ 2.33223796, -0.60701891,  0.32704136, ..., -0.09251223,
         1.04318455, -1.32284391],
       [ 1.7826994 ,  1.85618152,  1.15562047, ..., -0.02584253,
         1.03850269, -1.33282653],
       ...,
       [-1.14259331, -0.92485123, -0.09031802, ..., -0.0717345 ,
         1.77823747, -0.8237132 ],
       [-1.05458292, -0.84539315, -0.04021111, ..., -0.09122515,
         1.77823747, -0.87362627],
       [-0.78012947, -1.00430931, -0.07044252, ..., -0.04368215,
         1.75014627, -0.83369581]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="create_event" class="doc_header"><code>create_event</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loopstack.py#L12" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>create_event</code>(<strong><code>event_name</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="events" class="doc_header"><code>events</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loopstack.py#L17" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>events</code>(<strong>*<code>enames</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="LoopStack" class="doc_header"><code>class</code> <code>LoopStack</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loopstack.py#L21" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>LoopStack</code>(<strong><code>iterable</code></strong>=<em><code>[]</code></em>, <strong><code>name</code></strong>=<em><code>None</code></em>) :: <a href="/forgebox/loop#Loop"><code>Loop</code></a></p>
</blockquote>
<p>Basic loop class</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">TRAIN_EVENTS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DATA_PROCESS&quot;</span><span class="p">,</span><span class="s2">&quot;FORWARD&quot;</span><span class="p">,</span><span class="s2">&quot;LOSS_CALC&quot;</span><span class="p">,</span>
                <span class="s2">&quot;BACKWARD&quot;</span><span class="p">,</span><span class="s2">&quot;OPT_STEP&quot;</span><span class="p">,</span><span class="s2">&quot;METRICS&quot;</span><span class="p">]</span>
<span class="n">EVAL_EVENTS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DATA_PROCESS&quot;</span><span class="p">,</span><span class="s2">&quot;EVAL_WRAP&quot;</span><span class="p">,</span><span class="s2">&quot;FORWARD&quot;</span><span class="p">,</span><span class="s2">&quot;LOSS_CALC&quot;</span><span class="p">,</span><span class="s2">&quot;METRICS&quot;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="train_callbacks" class="doc_header"><code>train_callbacks</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loopstack.py#L60" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>train_callbacks</code>(<strong><code>loop</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="to_tensor" class="doc_header"><code>to_tensor</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loopstack.py#L77" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>to_tensor</code>(<strong><code>x</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="train_single_forward" class="doc_header"><code>train_single_forward</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loopstack.py#L80" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>train_single_forward</code>(<strong><code>metric_func</code></strong>=<em><code>[]</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TrainLoop" class="doc_header"><code>class</code> <code>TrainLoop</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loopstack.py#L108" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TrainLoop</code>(<strong><code>data_iter</code></strong>, <strong><code>model</code></strong>=<em><code>[]</code></em>, <strong><code>opt</code></strong>=<em><code>[]</code></em>, <strong><code>loss_func</code></strong>=<em><code>[]</code></em>, <strong><code>loss</code></strong>=<em><code>[]</code></em>, <strong><code>hp</code></strong>=<em><code>[]</code></em>, <strong><code>cuda</code></strong>=<em><code>[]</code></em>, <strong><code>callbacks</code></strong>=<em><code>[&lt;function train_callbacks at 0x112c34a70&gt;]</code></em>, <strong><code>tolerate</code></strong>=<em><code>True</code></em>) :: <a href="/forgebox/loopstack#LoopStack"><code>LoopStack</code></a></p>
</blockquote>
<p>Basic loop class</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="EvalLoop" class="doc_header"><code>class</code> <code>EvalLoop</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loopstack.py#L124" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>EvalLoop</code>(<strong><code>data_iter</code></strong>, <strong><code>tolerate</code></strong>=<em><code>True</code></em>) :: <a href="/forgebox/loopstack#LoopStack"><code>LoopStack</code></a></p>
</blockquote>
<p>Basic loop class</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="n">loop</span> <span class="o">=</span> <span class="n">TrainLoop</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">chunkify</span><span class="p">(</span><span class="n">x_normed</span><span class="p">),</span><span class="n">chunkify</span><span class="p">(</span><span class="n">y_normed</span><span class="p">))),</span>
                 <span class="n">tolerate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">train_callbacks</span><span class="p">,</span><span class="n">train_single_forward</span><span class="p">([</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()])])</span>
<span class="n">loop</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>assigning callback &lt;function train_callbacks at 0x1a28d47950&gt;
assigning callback &lt;function train_single_forward.&lt;locals&gt;.train_single_forward_cb at 0x1a28d5c5f0&gt;
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>LoopStack&gt;:TrainLoop
	layer🍰Loop
	layer🍰ProgressBar
	event🌏DATA_PROCESS
	event🌏FORWARD
	event🌏LOSS_CALC
	event🌏BACKWARD
	event🌏OPT_STEP
	event🌏METRICS</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loop</span><span class="o">.</span><span class="n">search</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loop</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Loop layer TrainLoop summary:
==================================================
🍰layer0.0	layer🍰Loop
--------------------------------------------------
🍰layer1.0	layer🍰ProgressBar
	[🐍func_name]	pgbar_data
	[⛰doc]	
        update progress bar with python dictionary
        data: python dictionary
        
	[😝var]	self,data
	[😜names]	t,set_postfix
	...................................
	[🐍func_name]	pgbar_description
	[⛰doc]	
        update progress bar prefix with text string
        
	[😝var]	self,text
	[😜names]	t,set_description_str
	...................................
--------------------------------------------------
🍰layer2.0	event🌏DATA_PROCESS
	[🐍func_name]	after_last_DATA_PROCESS
	[⛰doc]	
            Append new after_last callback for event:DATA_PROCESS
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	before_1st_DATA_PROCESS
	[⛰doc]	
            Append new before_1st callback for event:DATA_PROCESS
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	on_DATA_PROCESS
	[⛰doc]	
            Append new on callback for event:DATA_PROCESS
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
--------------------------------------------------
🍰layer3.0	event🌏FORWARD
	[🐍func_name]	after_last_FORWARD
	[⛰doc]	
            Append new after_last callback for event:FORWARD
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	before_1st_FORWARD
	[⛰doc]	
            Append new before_1st callback for event:FORWARD
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	on_FORWARD
	[⛰doc]	
            Append new on callback for event:FORWARD
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
--------------------------------------------------
🍰layer4.0	event🌏LOSS_CALC
	[🐍func_name]	after_last_LOSS_CALC
	[⛰doc]	
            Append new after_last callback for event:LOSS_CALC
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	before_1st_LOSS_CALC
	[⛰doc]	
            Append new before_1st callback for event:LOSS_CALC
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	on_LOSS_CALC
	[⛰doc]	
            Append new on callback for event:LOSS_CALC
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
--------------------------------------------------
🍰layer5.0	event🌏BACKWARD
	[🐍func_name]	after_last_BACKWARD
	[⛰doc]	
            Append new after_last callback for event:BACKWARD
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	before_1st_BACKWARD
	[⛰doc]	
            Append new before_1st callback for event:BACKWARD
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	on_BACKWARD
	[⛰doc]	
            Append new on callback for event:BACKWARD
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
--------------------------------------------------
🍰layer6.0	event🌏OPT_STEP
	[🐍func_name]	after_last_OPT_STEP
	[⛰doc]	
            Append new after_last callback for event:OPT_STEP
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	before_1st_OPT_STEP
	[⛰doc]	
            Append new before_1st callback for event:OPT_STEP
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	on_OPT_STEP
	[⛰doc]	
            Append new on callback for event:OPT_STEP
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
--------------------------------------------------
🍰layer7.0	event🌏METRICS
	[🐍func_name]	after_last_METRICS
	[⛰doc]	
            Append new after_last callback for event:METRICS
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	before_1st_METRICS
	[⛰doc]	
            Append new before_1st callback for event:METRICS
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	on_METRICS
	[⛰doc]	
            Append new on callback for event:METRICS
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
--------------------------------------------------
🍰layer8.0	LoopStack&gt;:TrainLoop
	layer🍰Loop
	layer🍰ProgressBar
	event🌏DATA_PROCESS
	event🌏FORWARD
	event🌏LOSS_CALC
	event🌏BACKWARD
	event🌏OPT_STEP
	event🌏METRICS
--------------------------------------------------
==================================================

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loop</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="s2">&quot;baseline&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># loop.loss_func[&quot;mse&quot;] = torch.nn.MSELoss()</span>
<span class="c1"># loop.metric_func[&quot;loss&quot;]= torch.nn.MSELoss()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loop</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-79-bc3c14747a31&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>loop<span class="ansi-blue-fg">.</span>run<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">run</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    196</span>         self<span class="ansi-blue-fg">.</span>refresh_i<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    197</span>         first<span class="ansi-blue-fg">.</span>start_callon<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 198</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">for</span> element <span class="ansi-green-fg">in</span> first<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    199</span>             first<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    200</span>         first<span class="ansi-blue-fg">.</span>end_callon<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">__iter__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    308</span>                 self<span class="ansi-blue-fg">.</span>update_i<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    309</span>             self<span class="ansi-blue-fg">.</span>core<span class="ansi-blue-fg">.</span>element <span class="ansi-blue-fg">=</span> element
<span class="ansi-green-fg">--&gt; 310</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>callon<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    311</span>             <span class="ansi-green-fg">yield</span> self<span class="ansi-blue-fg">.</span>element
<span class="ansi-green-intense-fg ansi-bold">    312</span> 

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">callon</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    262</span>     <span class="ansi-green-fg">def</span> callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    263</span>         self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 264</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>iter_cb<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    265</span> 
<span class="ansi-green-intense-fg ansi-bold">    266</span>     <span class="ansi-green-fg">def</span> start_callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">downstream_wrap</span><span class="ansi-blue-fg">(self, f)</span>
<span class="ansi-green-intense-fg ansi-bold">    208</span> 
<span class="ansi-green-intense-fg ansi-bold">    209</span>     <span class="ansi-green-fg">def</span> downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>f<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 210</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    211</span> 
<span class="ansi-green-intense-fg ansi-bold">    212</span>     <span class="ansi-green-fg">def</span> downstream_start_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>f<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">iter_cb</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    277</span>         &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    278</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>next_layer<span class="ansi-blue-fg">!=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 279</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>next_layer<span class="ansi-blue-fg">.</span>callon<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    280</span>         self<span class="ansi-blue-fg">.</span>after<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    281</span> 

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">callon</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    262</span>     <span class="ansi-green-fg">def</span> callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    263</span>         self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 264</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>iter_cb<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    265</span> 
<span class="ansi-green-intense-fg ansi-bold">    266</span>     <span class="ansi-green-fg">def</span> start_callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">downstream_wrap</span><span class="ansi-blue-fg">(self, f)</span>
<span class="ansi-green-intense-fg ansi-bold">    208</span> 
<span class="ansi-green-intense-fg ansi-bold">    209</span>     <span class="ansi-green-fg">def</span> downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>f<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 210</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    211</span> 
<span class="ansi-green-intense-fg ansi-bold">    212</span>     <span class="ansi-green-fg">def</span> downstream_start_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>f<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">iter_cb</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    277</span>         &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    278</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>next_layer<span class="ansi-blue-fg">!=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 279</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>next_layer<span class="ansi-blue-fg">.</span>callon<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    280</span>         self<span class="ansi-blue-fg">.</span>after<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    281</span> 

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">callon</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    262</span>     <span class="ansi-green-fg">def</span> callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    263</span>         self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 264</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>iter_cb<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    265</span> 
<span class="ansi-green-intense-fg ansi-bold">    266</span>     <span class="ansi-green-fg">def</span> start_callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">downstream_wrap</span><span class="ansi-blue-fg">(self, f)</span>
<span class="ansi-green-intense-fg ansi-bold">    208</span> 
<span class="ansi-green-intense-fg ansi-bold">    209</span>     <span class="ansi-green-fg">def</span> downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>f<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 210</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    211</span> 
<span class="ansi-green-intense-fg ansi-bold">    212</span>     <span class="ansi-green-fg">def</span> downstream_start_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>f<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">iter_cb</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    277</span>         &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    278</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>next_layer<span class="ansi-blue-fg">!=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 279</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>next_layer<span class="ansi-blue-fg">.</span>callon<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    280</span>         self<span class="ansi-blue-fg">.</span>after<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    281</span> 

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">callon</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    262</span>     <span class="ansi-green-fg">def</span> callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    263</span>         self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 264</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>iter_cb<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    265</span> 
<span class="ansi-green-intense-fg ansi-bold">    266</span>     <span class="ansi-green-fg">def</span> start_callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">downstream_wrap</span><span class="ansi-blue-fg">(self, f)</span>
<span class="ansi-green-intense-fg ansi-bold">    208</span> 
<span class="ansi-green-intense-fg ansi-bold">    209</span>     <span class="ansi-green-fg">def</span> downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>f<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 210</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    211</span> 
<span class="ansi-green-intense-fg ansi-bold">    212</span>     <span class="ansi-green-fg">def</span> downstream_start_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>f<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">iter_cb</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    277</span>         &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    278</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>next_layer<span class="ansi-blue-fg">!=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 279</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>next_layer<span class="ansi-blue-fg">.</span>callon<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    280</span>         self<span class="ansi-blue-fg">.</span>after<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    281</span> 

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">callon</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    262</span>     <span class="ansi-green-fg">def</span> callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    263</span>         self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 264</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>iter_cb<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    265</span> 
<span class="ansi-green-intense-fg ansi-bold">    266</span>     <span class="ansi-green-fg">def</span> start_callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">downstream_wrap</span><span class="ansi-blue-fg">(self, f)</span>
<span class="ansi-green-intense-fg ansi-bold">    208</span> 
<span class="ansi-green-intense-fg ansi-bold">    209</span>     <span class="ansi-green-fg">def</span> downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>f<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 210</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    211</span> 
<span class="ansi-green-intense-fg ansi-bold">    212</span>     <span class="ansi-green-fg">def</span> downstream_start_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>f<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">iter_cb</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    277</span>         &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    278</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>next_layer<span class="ansi-blue-fg">!=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 279</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>next_layer<span class="ansi-blue-fg">.</span>callon<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    280</span>         self<span class="ansi-blue-fg">.</span>after<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    281</span> 

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">callon</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    261</span> 
<span class="ansi-green-intense-fg ansi-bold">    262</span>     <span class="ansi-green-fg">def</span> callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 263</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    264</span>         self<span class="ansi-blue-fg">.</span>downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>iter_cb<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    265</span> 

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    459</span>     <span class="ansi-green-fg">def</span> __call__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    460</span>         <span class="ansi-green-fg">if</span> len<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>cbs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">&gt;</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 461</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>cbs<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>callon<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    462</span> 
<span class="ansi-green-intense-fg ansi-bold">    463</span>     <span class="ansi-green-fg">def</span> start_call<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">callon</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    261</span> 
<span class="ansi-green-intense-fg ansi-bold">    262</span>     <span class="ansi-green-fg">def</span> callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 263</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    264</span>         self<span class="ansi-blue-fg">.</span>downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>iter_cb<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    265</span> 

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self_)</span>
<span class="ansi-green-intense-fg ansi-bold">    476</span>                 self_<span class="ansi-blue-fg">.</span>f <span class="ansi-blue-fg">=</span> f
<span class="ansi-green-intense-fg ansi-bold">    477</span> 
<span class="ansi-green-fg">--&gt; 478</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">def</span> __call__<span class="ansi-blue-fg">(</span>self_<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> self_<span class="ansi-blue-fg">.</span>f<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    479</span> 
<span class="ansi-green-intense-fg ansi-bold">    480</span>         new_cb <span class="ansi-blue-fg">=</span> EventCB<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-72-4b7d22181575&gt;</span> in <span class="ansi-cyan-fg">opt_step</span><span class="ansi-blue-fg">(loop)</span>
<span class="ansi-green-intense-fg ansi-bold">     13</span>     <span class="ansi-blue-fg">@</span>loop<span class="ansi-blue-fg">.</span>BACKWARD<span class="ansi-blue-fg">.</span>on
<span class="ansi-green-intense-fg ansi-bold">     14</span>     <span class="ansi-green-fg">def</span> opt_step<span class="ansi-blue-fg">(</span>loop<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 15</span><span class="ansi-red-fg">         </span>loop<span class="ansi-blue-fg">.</span>loss<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;backward&#34;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     16</span> 
<span class="ansi-green-intense-fg ansi-bold">     17</span>     <span class="ansi-blue-fg">@</span>loop<span class="ansi-blue-fg">.</span>BACKWARD<span class="ansi-blue-fg">.</span>on

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self, func, *args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     60</span>         <span class="ansi-green-fg">for</span> k<span class="ansi-blue-fg">,</span>case <span class="ansi-green-fg">in</span> self<span class="ansi-blue-fg">.</span>cases<span class="ansi-blue-fg">.</span>items<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     61</span>             <span class="ansi-green-fg">if</span> type<span class="ansi-blue-fg">(</span>func<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">==</span>str<span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 62</span><span class="ansi-red-fg">                 </span>results<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>getattr<span class="ansi-blue-fg">(</span>case<span class="ansi-blue-fg">,</span>func<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     63</span>             <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     64</span>                 results<span class="ansi-blue-fg">.</span>append<span class="ansi-blue-fg">(</span>func<span class="ansi-blue-fg">(</span>case<span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">*</span>args<span class="ansi-blue-fg">,</span><span class="ansi-blue-fg">**</span>kwargs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>

<span class="ansi-red-fg">AttributeError</span>: &#39;list&#39; object has no attribute &#39;backward&#39;</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loop</span><span class="o">.</span><span class="n">model</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>🍄:model[
	baseline
]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loop</span><span class="o">.</span><span class="n">loss_func</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>🍄:loss_func[
	
]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">loop</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Tensor</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loop</span><span class="o">.</span><span class="n">metric</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>🍄:metric[
	
]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_error</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    String format error massage and trace back</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">traceback</span>
    <span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
    <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
    <span class="n">sio</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exception</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="p">,</span>
                              <span class="n">limit</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sio</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sio</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">error_list</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;error&quot;</span><span class="p">]</span>
<span class="n">get_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;NoneType: None\n&#39;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">e</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>IndexError(&#39;list index out of range&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loop</span><span class="o">.</span><span class="n">pred</span><span class="p">,</span><span class="n">loop</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">y1</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(tensor([[ 0.7769],
         [ 0.2967],
         [ 0.6991],
         [ 0.6803],
         [ 0.3590],
         [ 0.5273],
         [ 0.4915],
         [ 0.3569],
         [-0.0015],
         [ 0.4416],
         [ 0.3151],
         [ 0.3791],
         [ 0.3341],
         [ 0.4002],
         [ 0.2497],
         [ 0.2458],
         [ 0.2327],
         [ 0.3615],
         [ 0.0947],
         [ 0.2408],
         [-0.1149],
         [ 0.0087],
         [ 0.0926],
         [ 0.2175],
         [ 0.2622],
         [ 0.1142],
         [ 0.2609],
         [ 0.1703],
         [ 0.1444],
         [ 0.2212],
         [ 0.0442],
         [ 0.1634]], grad_fn=&lt;AddmmBackward&gt;),
 tensor([ 2.1296,  1.3142,  1.2587,  1.1651,  1.1729,  0.5446,  0.8003,  0.2994,
          0.1720,  0.4701,  0.6469,  0.3028,  0.0576, -0.1348, -0.4130, -0.5794,
         -0.4711, -0.4451, -0.4173, -0.3809, -0.5144, -0.4078, -0.8056, -0.9286,
         -0.6435, -0.8610, -0.9797, -0.8784, -0.8489, -0.6487, -0.7328, -0.7943]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}
</div>
 

