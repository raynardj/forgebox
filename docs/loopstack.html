---

title: Title

keywords: fastai
sidebar: home_sidebar

summary: "summary"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/15_loopstack.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    {% raw %}
        
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="15-LoopStack">15 LoopStack<a class="anchor-link" href="#15-LoopStack">&#182;</a></h1>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>To run through iterations quickly, we use the california housing data</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">sklearn.datasets.california_housing</span> <span class="kn">import</span> <span class="n">fetch_california_housing</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">fetch_california_housing</span><span class="p">(</span><span class="n">return_X_y</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>

<span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">y</span><span class="o">.</span><span class="n">shape</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((20640, 8), (20640,))</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Normalized Data</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Preview x input</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">s</span><span class="p">):</span> <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">m</span><span class="p">)</span><span class="o">/</span><span class="n">s</span>
<span class="k">def</span> <span class="nf">denorm</span><span class="p">(</span><span class="n">m</span><span class="p">,</span><span class="n">s</span><span class="p">):</span> <span class="k">return</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="p">(</span><span class="n">x</span><span class="o">*</span><span class="n">s</span><span class="p">)</span><span class="o">+</span><span class="n">m</span>

<span class="n">x_normed</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span><span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">0</span><span class="p">))(</span><span class="n">x</span><span class="p">)</span>
<span class="n">y_normed</span> <span class="o">=</span> <span class="n">norm</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">mean</span><span class="p">(),</span><span class="n">y</span><span class="o">.</span><span class="n">std</span><span class="p">())(</span><span class="n">y</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x_normed</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">),</span><span class="n">x_normed</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span>\
<span class="n">y_normed</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">float16</span><span class="p">),</span><span class="n">y_normed</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(array([ 0.,  0.,  0., -0., -0.,  0., -0., -0.], dtype=float16),
 array([1., 1., 1., 1., 1., 1., 1., 1.]),
 0.0,
 1.0)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">x_normed</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1000</span><span class="p">),</span><span class="mi">10</span><span class="p">)])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.image.AxesImage at 0x1a145872d0&gt;</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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
"
>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x_normed</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([[ 2.34476576,  0.98214266,  0.62855945, ..., -0.04959654,
         1.05254828, -1.32783522],
       [ 2.33223796, -0.60701891,  0.32704136, ..., -0.09251223,
         1.04318455, -1.32284391],
       [ 1.7826994 ,  1.85618152,  1.15562047, ..., -0.02584253,
         1.03850269, -1.33282653],
       ...,
       [-1.14259331, -0.92485123, -0.09031802, ..., -0.0717345 ,
         1.77823747, -0.8237132 ],
       [-1.05458292, -0.84539315, -0.04021111, ..., -0.09122515,
         1.77823747, -0.87362627],
       [-0.78012947, -1.00430931, -0.07044252, ..., -0.04368215,
         1.75014627, -0.83369581]])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="create_event" class="doc_header"><code>create_event</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loopstack.py#L12" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>create_event</code>(<strong><code>event_name</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="events" class="doc_header"><code>events</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loopstack.py#L17" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>events</code>(<strong>*<code>enames</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="LoopStack" class="doc_header"><code>class</code> <code>LoopStack</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loopstack.py#L21" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>LoopStack</code>(<strong><code>iterable</code></strong>=<em><code>[]</code></em>, <strong><code>name</code></strong>=<em><code>None</code></em>) :: <a href="/forgebox/loop#Loop"><code>Loop</code></a></p>
</blockquote>
<p>Basic loop class</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">TRAIN_EVENTS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DATA_PROCESS&quot;</span><span class="p">,</span><span class="s2">&quot;FORWARD&quot;</span><span class="p">,</span><span class="s2">&quot;LOSS_CALC&quot;</span><span class="p">,</span>
                <span class="s2">&quot;BACKWARD&quot;</span><span class="p">,</span><span class="s2">&quot;OPT_STEP&quot;</span><span class="p">,</span><span class="s2">&quot;METRICS&quot;</span><span class="p">]</span>
<span class="n">EVAL_EVENTS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;DATA_PROCESS&quot;</span><span class="p">,</span><span class="s2">&quot;EVAL_WRAP&quot;</span><span class="p">,</span><span class="s2">&quot;FORWARD&quot;</span><span class="p">,</span><span class="s2">&quot;LOSS_CALC&quot;</span><span class="p">,</span><span class="s2">&quot;METRICS&quot;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="train_callbacks" class="doc_header"><code>train_callbacks</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loopstack.py#L62" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>train_callbacks</code>(<strong><code>loop</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="to_tensor" class="doc_header"><code>to_tensor</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loopstack.py#L79" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>to_tensor</code>(<strong><code>x</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="train_single_forward" class="doc_header"><code>train_single_forward</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loopstack.py#L82" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>train_single_forward</code>(<strong><code>metric_func</code></strong>=<em><code>[]</code></em>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="TrainLoop" class="doc_header"><code>class</code> <code>TrainLoop</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loopstack.py#L114" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>TrainLoop</code>(<strong><code>data_iter</code></strong>, <strong><code>model</code></strong>=<em><code>[]</code></em>, <strong><code>opt</code></strong>=<em><code>[]</code></em>, <strong><code>loss_func</code></strong>=<em><code>[]</code></em>, <strong><code>loss</code></strong>=<em><code>[]</code></em>, <strong><code>hp</code></strong>=<em><code>[]</code></em>, <strong><code>cuda</code></strong>=<em><code>[]</code></em>, <strong><code>callbacks</code></strong>=<em><code>[&lt;function train_callbacks at 0x10ee01710&gt;]</code></em>, <strong><code>tolerate</code></strong>=<em><code>True</code></em>) :: <a href="/forgebox/loopstack#LoopStack"><code>LoopStack</code></a></p>
</blockquote>
<p>Basic loop class</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="EvalLoop" class="doc_header"><code>class</code> <code>EvalLoop</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loopstack.py#L132" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>EvalLoop</code>(<strong><code>data_iter</code></strong>, <strong><code>tolerate</code></strong>=<em><code>True</code></em>) :: <a href="/forgebox/loopstack#LoopStack"><code>LoopStack</code></a></p>
</blockquote>
<p>Basic loop class</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
<span class="n">loop</span> <span class="o">=</span> <span class="n">TrainLoop</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">chunkify</span><span class="p">(</span><span class="n">x_normed</span><span class="p">),</span><span class="n">chunkify</span><span class="p">(</span><span class="n">y_normed</span><span class="p">))),</span>
                 <span class="n">tolerate</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                 <span class="n">callbacks</span><span class="o">=</span><span class="p">[</span><span class="n">train_callbacks</span><span class="p">,</span>
                            <span class="n">train_single_forward</span><span class="p">([</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()])])</span>
<span class="n">loop</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>assigning callback &lt;function train_callbacks at 0x1a248cc200&gt;
assigning callback &lt;function train_single_forward.&lt;locals&gt;.train_single_forward_cb at 0x1a252f3170&gt;
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>LoopStack&gt;:TrainLoop
	layer🍰Loop
	layer🍰ProgressBar
	event🌏DATA_PROCESS
	event🌏FORWARD
	event🌏LOSS_CALC
	event🌏BACKWARD
	event🌏OPT_STEP
	event🌏METRICS</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loop</span><span class="o">.</span><span class="n">search</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loop</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Loop layer TrainLoop summary:
==================================================
🍰layer0.0	layer🍰Loop
--------------------------------------------------
🍰layer1.0	layer🍰ProgressBar
	[🐍func_name]	pgbar_data
	[⛰doc]	
        update progress bar with python dictionary
        data: python dictionary
        
	[😝var]	self,data
	[😜names]	t,set_postfix
	...................................
	[🐍func_name]	pgbar_description
	[⛰doc]	
        update progress bar prefix with text string
        
	[😝var]	self,text
	[😜names]	t,set_description_str
	...................................
--------------------------------------------------
🍰layer2.0	event🌏DATA_PROCESS
	[🐍func_name]	after_last_DATA_PROCESS
	[⛰doc]	
            Append new after_last callback for event:DATA_PROCESS
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	before_1st_DATA_PROCESS
	[⛰doc]	
            Append new before_1st callback for event:DATA_PROCESS
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	on_DATA_PROCESS
	[⛰doc]	
            Append new on callback for event:DATA_PROCESS
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
--------------------------------------------------
🍰layer3.0	event🌏FORWARD
	[🐍func_name]	after_last_FORWARD
	[⛰doc]	
            Append new after_last callback for event:FORWARD
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	before_1st_FORWARD
	[⛰doc]	
            Append new before_1st callback for event:FORWARD
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	on_FORWARD
	[⛰doc]	
            Append new on callback for event:FORWARD
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
--------------------------------------------------
🍰layer4.0	event🌏LOSS_CALC
	[🐍func_name]	after_last_LOSS_CALC
	[⛰doc]	
            Append new after_last callback for event:LOSS_CALC
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	before_1st_LOSS_CALC
	[⛰doc]	
            Append new before_1st callback for event:LOSS_CALC
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	on_LOSS_CALC
	[⛰doc]	
            Append new on callback for event:LOSS_CALC
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
--------------------------------------------------
🍰layer5.0	event🌏BACKWARD
	[🐍func_name]	after_last_BACKWARD
	[⛰doc]	
            Append new after_last callback for event:BACKWARD
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	before_1st_BACKWARD
	[⛰doc]	
            Append new before_1st callback for event:BACKWARD
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	on_BACKWARD
	[⛰doc]	
            Append new on callback for event:BACKWARD
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
--------------------------------------------------
🍰layer6.0	event🌏OPT_STEP
	[🐍func_name]	after_last_OPT_STEP
	[⛰doc]	
            Append new after_last callback for event:OPT_STEP
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	before_1st_OPT_STEP
	[⛰doc]	
            Append new before_1st callback for event:OPT_STEP
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	on_OPT_STEP
	[⛰doc]	
            Append new on callback for event:OPT_STEP
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
--------------------------------------------------
🍰layer7.0	event🌏METRICS
	[🐍func_name]	after_last_METRICS
	[⛰doc]	
            Append new after_last callback for event:METRICS
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	before_1st_METRICS
	[⛰doc]	
            Append new before_1st callback for event:METRICS
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
	[🐍func_name]	on_METRICS
	[⛰doc]	
            Append new on callback for event:METRICS
            Use this function as decorator
        
	[😝var]	cls,f
	[😜names]	getattr
	...................................
--------------------------------------------------
🍰layer8.0	LoopStack&gt;:TrainLoop
	layer🍰Loop
	layer🍰ProgressBar
	event🌏DATA_PROCESS
	event🌏FORWARD
	event🌏LOSS_CALC
	event🌏BACKWARD
	event🌏OPT_STEP
	event🌏METRICS
--------------------------------------------------
==================================================

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">torch</span> <span class="kn">import</span> <span class="n">nn</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loop</span><span class="o">.</span><span class="n">model</span><span class="p">[</span><span class="s2">&quot;baseline&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">Linear</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loop</span><span class="o">.</span><span class="n">loss_func</span><span class="p">[</span><span class="s2">&quot;mse&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
<span class="n">loop</span><span class="o">.</span><span class="n">metric_func</span><span class="p">[</span><span class="s2">&quot;loss&quot;</span><span class="p">]</span><span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loop</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_text output_error">
<pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-30-bc3c14747a31&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-fg">----&gt; 1</span><span class="ansi-red-fg"> </span>loop<span class="ansi-blue-fg">.</span>run<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">run</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    205</span>         self<span class="ansi-blue-fg">.</span>refresh_i<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    206</span>         first<span class="ansi-blue-fg">.</span>start_callon<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 207</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">for</span> element <span class="ansi-green-fg">in</span> first<span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    208</span>             first<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    209</span>         first<span class="ansi-blue-fg">.</span>end_callon<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">__iter__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    317</span>                 self<span class="ansi-blue-fg">.</span>update_i<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    318</span>             self<span class="ansi-blue-fg">.</span>core<span class="ansi-blue-fg">.</span>element <span class="ansi-blue-fg">=</span> element
<span class="ansi-green-fg">--&gt; 319</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>callon<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    320</span>             <span class="ansi-green-fg">yield</span> self<span class="ansi-blue-fg">.</span>element
<span class="ansi-green-intense-fg ansi-bold">    321</span> 

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">callon</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    271</span>     <span class="ansi-green-fg">def</span> callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    272</span>         self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 273</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>iter_cb<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    274</span> 
<span class="ansi-green-intense-fg ansi-bold">    275</span>     <span class="ansi-green-fg">def</span> start_callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">downstream_wrap</span><span class="ansi-blue-fg">(self, f)</span>
<span class="ansi-green-intense-fg ansi-bold">    217</span> 
<span class="ansi-green-intense-fg ansi-bold">    218</span>     <span class="ansi-green-fg">def</span> downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>f<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 219</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    220</span> 
<span class="ansi-green-intense-fg ansi-bold">    221</span>     <span class="ansi-green-fg">def</span> downstream_start_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>f<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">iter_cb</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    286</span>         &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    287</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>next_layer<span class="ansi-blue-fg">!=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 288</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>next_layer<span class="ansi-blue-fg">.</span>callon<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    289</span>         self<span class="ansi-blue-fg">.</span>after<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    290</span> 

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">callon</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    271</span>     <span class="ansi-green-fg">def</span> callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    272</span>         self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 273</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>iter_cb<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    274</span> 
<span class="ansi-green-intense-fg ansi-bold">    275</span>     <span class="ansi-green-fg">def</span> start_callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">downstream_wrap</span><span class="ansi-blue-fg">(self, f)</span>
<span class="ansi-green-intense-fg ansi-bold">    217</span> 
<span class="ansi-green-intense-fg ansi-bold">    218</span>     <span class="ansi-green-fg">def</span> downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>f<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 219</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    220</span> 
<span class="ansi-green-intense-fg ansi-bold">    221</span>     <span class="ansi-green-fg">def</span> downstream_start_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>f<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">iter_cb</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    286</span>         &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    287</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>next_layer<span class="ansi-blue-fg">!=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 288</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>next_layer<span class="ansi-blue-fg">.</span>callon<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    289</span>         self<span class="ansi-blue-fg">.</span>after<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    290</span> 

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">callon</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    271</span>     <span class="ansi-green-fg">def</span> callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    272</span>         self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 273</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>iter_cb<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    274</span> 
<span class="ansi-green-intense-fg ansi-bold">    275</span>     <span class="ansi-green-fg">def</span> start_callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">downstream_wrap</span><span class="ansi-blue-fg">(self, f)</span>
<span class="ansi-green-intense-fg ansi-bold">    217</span> 
<span class="ansi-green-intense-fg ansi-bold">    218</span>     <span class="ansi-green-fg">def</span> downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>f<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 219</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    220</span> 
<span class="ansi-green-intense-fg ansi-bold">    221</span>     <span class="ansi-green-fg">def</span> downstream_start_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>f<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">iter_cb</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    286</span>         &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    287</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>next_layer<span class="ansi-blue-fg">!=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 288</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>next_layer<span class="ansi-blue-fg">.</span>callon<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    289</span>         self<span class="ansi-blue-fg">.</span>after<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    290</span> 

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">callon</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    270</span> 
<span class="ansi-green-intense-fg ansi-bold">    271</span>     <span class="ansi-green-fg">def</span> callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 272</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    273</span>         self<span class="ansi-blue-fg">.</span>downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>iter_cb<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    274</span> 

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    468</span>     <span class="ansi-green-fg">def</span> __call__<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    469</span>         <span class="ansi-green-fg">if</span> len<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>cbs<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">&gt;</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 470</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>cbs<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">.</span>callon<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    471</span> 
<span class="ansi-green-intense-fg ansi-bold">    472</span>     <span class="ansi-green-fg">def</span> start_call<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">callon</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    271</span>     <span class="ansi-green-fg">def</span> callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">    272</span>         self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 273</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">.</span>downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>iter_cb<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    274</span> 
<span class="ansi-green-intense-fg ansi-bold">    275</span>     <span class="ansi-green-fg">def</span> start_callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">downstream_wrap</span><span class="ansi-blue-fg">(self, f)</span>
<span class="ansi-green-intense-fg ansi-bold">    217</span> 
<span class="ansi-green-intense-fg ansi-bold">    218</span>     <span class="ansi-green-fg">def</span> downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>f<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 219</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> f<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    220</span> 
<span class="ansi-green-intense-fg ansi-bold">    221</span>     <span class="ansi-green-fg">def</span> downstream_start_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span>f<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">iter_cb</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    286</span>         &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    287</span>         <span class="ansi-green-fg">if</span> self<span class="ansi-blue-fg">.</span>next_layer<span class="ansi-blue-fg">!=</span><span class="ansi-green-fg">None</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 288</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>next_layer<span class="ansi-blue-fg">.</span>callon<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    289</span>         self<span class="ansi-blue-fg">.</span>after<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    290</span> 

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">callon</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">    270</span> 
<span class="ansi-green-intense-fg ansi-bold">    271</span>     <span class="ansi-green-fg">def</span> callon<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">--&gt; 272</span><span class="ansi-red-fg">         </span>self<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    273</span>         self<span class="ansi-blue-fg">.</span>downstream_wrap<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>iter_cb<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    274</span> 

<span class="ansi-green-fg">~/github/forgebox/forgebox/loop.py</span> in <span class="ansi-cyan-fg">__call__</span><span class="ansi-blue-fg">(self_)</span>
<span class="ansi-green-intense-fg ansi-bold">    485</span>                 self_<span class="ansi-blue-fg">.</span>f <span class="ansi-blue-fg">=</span> f
<span class="ansi-green-intense-fg ansi-bold">    486</span> 
<span class="ansi-green-fg">--&gt; 487</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">def</span> __call__<span class="ansi-blue-fg">(</span>self_<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span> self_<span class="ansi-blue-fg">.</span>f<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    488</span> 
<span class="ansi-green-intense-fg ansi-bold">    489</span>         new_cb <span class="ansi-blue-fg">=</span> EventCB<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">&lt;ipython-input-23-d81feeb13f19&gt;</span> in <span class="ansi-cyan-fg">forward_pass</span><span class="ansi-blue-fg">(self)</span>
<span class="ansi-green-intense-fg ansi-bold">     33</span>         <span class="ansi-green-fg">def</span> forward_pass<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     34</span>             y_ <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>model<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;__call__&#34;</span><span class="ansi-blue-fg">,</span>self<span class="ansi-blue-fg">.</span>var<span class="ansi-blue-fg">.</span>x<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 35</span><span class="ansi-red-fg">             </span>self<span class="ansi-blue-fg">.</span>var<span class="ansi-blue-fg">.</span>y_ <span class="ansi-blue-fg">=</span> y_<span class="ansi-blue-fg">.</span>popitem<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">     36</span> 
<span class="ansi-green-intense-fg ansi-bold">     37</span>         <span class="ansi-blue-fg">@</span>self<span class="ansi-blue-fg">.</span>on_LOSS_CALC

<span class="ansi-red-fg">AttributeError</span>: &#39;Tensor&#39; object has no attribute &#39;popitem&#39;</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loop</span><span class="o">.</span><span class="n">model</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>🍄:model[
	baseline
]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loop</span><span class="o">.</span><span class="n">loss_func</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>🍄:loss_func[
	
]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="nb">type</span><span class="p">(</span><span class="n">loop</span><span class="o">.</span><span class="n">x</span><span class="o">.</span><span class="n">x1</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>torch.Tensor</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loop</span><span class="o">.</span><span class="n">metric</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>🍄:metric[
	
]</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">get_error</span><span class="p">(</span><span class="n">e</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    String format error massage and trace back</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="kn">import</span> <span class="nn">sys</span><span class="o">,</span><span class="nn">traceback</span>
    <span class="kn">from</span> <span class="nn">io</span> <span class="kn">import</span> <span class="n">StringIO</span>
    <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()</span>
    <span class="n">sio</span> <span class="o">=</span> <span class="n">StringIO</span><span class="p">()</span>
    <span class="n">traceback</span><span class="o">.</span><span class="n">print_exception</span><span class="p">(</span><span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_value</span><span class="p">,</span> <span class="n">exc_traceback</span><span class="p">,</span>
                              <span class="n">limit</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">file</span><span class="o">=</span><span class="n">sio</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sio</span><span class="o">.</span><span class="n">getvalue</span><span class="p">()</span>

<span class="n">e</span> <span class="o">=</span> <span class="n">loop</span><span class="o">.</span><span class="n">error_list</span><span class="p">()[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;error&quot;</span><span class="p">]</span>
<span class="n">get_error</span><span class="p">(</span><span class="n">e</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&#39;NoneType: None\n&#39;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">e</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>IndexError(&#39;list index out of range&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">loop</span><span class="o">.</span><span class="n">pred</span><span class="p">,</span><span class="n">loop</span><span class="o">.</span><span class="n">y</span><span class="o">.</span><span class="n">y1</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(tensor([[ 0.7769],
         [ 0.2967],
         [ 0.6991],
         [ 0.6803],
         [ 0.3590],
         [ 0.5273],
         [ 0.4915],
         [ 0.3569],
         [-0.0015],
         [ 0.4416],
         [ 0.3151],
         [ 0.3791],
         [ 0.3341],
         [ 0.4002],
         [ 0.2497],
         [ 0.2458],
         [ 0.2327],
         [ 0.3615],
         [ 0.0947],
         [ 0.2408],
         [-0.1149],
         [ 0.0087],
         [ 0.0926],
         [ 0.2175],
         [ 0.2622],
         [ 0.1142],
         [ 0.2609],
         [ 0.1703],
         [ 0.1444],
         [ 0.2212],
         [ 0.0442],
         [ 0.1634]], grad_fn=&lt;AddmmBackward&gt;),
 tensor([ 2.1296,  1.3142,  1.2587,  1.1651,  1.1729,  0.5446,  0.8003,  0.2994,
          0.1720,  0.4701,  0.6469,  0.3028,  0.0576, -0.1348, -0.4130, -0.5794,
         -0.4711, -0.4451, -0.4173, -0.3809, -0.5144, -0.4078, -0.8056, -0.9286,
         -0.6435, -0.8610, -0.9797, -0.8784, -0.8489, -0.6487, -0.7328, -0.7943]))</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}
</div>
 

