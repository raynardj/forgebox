---

title: Categorical Transformation for DL

keywords: fastai
sidebar: home_sidebar

summary: "a list of things to categoryical transformation"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/53_category.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    {% raw %}
        
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Imports">Imports<a class="anchor-link" href="#Imports">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="C2I" class="doc_header"><code>class</code> <code>C2I</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/category.py#L14" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>C2I</code>(<strong><code>arr</code></strong>:<code>Iterable</code>[<code>T_co</code>], <strong><code>pad_mst</code></strong>:<code>bool</code>=<em><code>False</code></em>)</p>
</blockquote>
<p>Category to indices</p>
<blockquote><blockquote><blockquote><p>c2i = C2I(
        ["class 1", "class 2", ..., "class n"],
        pad_mst=True,
        )
c2i[["class 2", "class 5"]]
[0] array([2,3])</p>
</blockquote>
</blockquote>
</blockquote>
<p>If the indices you put in the slicing is a np.ndarray
    a verctorized function will be used</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Category" class="doc_header"><code>class</code> <code>Category</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/category.py#L65" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Category</code>(<strong><code>arr</code></strong>:<code>Iterable</code>[<code>T_co</code>], <strong><code>pad_mst</code></strong>:<code>bool</code>=<em><code>False</code></em>)</p>
</blockquote>
<p>Manage categorical translations
c = Category(
        ["class 1", "class 2", ..., "class n"],
        pad_mst=True,)</p>
<p>c.c2i[["class 3","class 6"]]
c.i2c[[3, 2, 1]]</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Indexing-forward-and-backward">Indexing forward and backward<a class="anchor-link" href="#Indexing-forward-and-backward">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cates</span> <span class="o">=</span> <span class="n">Category</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span><span class="sa">f</span><span class="s2">&quot;Cate_{x+1}&quot;</span><span class="p">,</span><span class="nb">range</span><span class="p">(</span><span class="mi">50</span><span class="p">))))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cates</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Category Manager with 50</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cates</span><span class="o">.</span><span class="n">i2c</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([&#39;Cate_1&#39;, &#39;Cate_2&#39;, &#39;Cate_3&#39;, &#39;Cate_4&#39;, &#39;Cate_5&#39;], dtype=&#39;&lt;U7&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">test_c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">50</span><span class="p">,</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Indices-to-categories">Indices to categories<a class="anchor-link" href="#Indices-to-categories">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">labels</span> <span class="o">=</span> <span class="n">cates</span><span class="o">.</span><span class="n">i2c</span><span class="p">[</span><span class="n">test_c</span><span class="p">]</span>
<span class="n">labels</span><span class="p">[:</span><span class="mi">20</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([&#39;Cate_13&#39;, &#39;Cate_4&#39;, &#39;Cate_4&#39;, &#39;Cate_47&#39;, &#39;Cate_36&#39;, &#39;Cate_10&#39;,
       &#39;Cate_22&#39;, &#39;Cate_5&#39;, &#39;Cate_11&#39;, &#39;Cate_15&#39;, &#39;Cate_40&#39;, &#39;Cate_18&#39;,
       &#39;Cate_24&#39;, &#39;Cate_9&#39;, &#39;Cate_2&#39;, &#39;Cate_2&#39;, &#39;Cate_43&#39;, &#39;Cate_46&#39;,
       &#39;Cate_47&#39;, &#39;Cate_9&#39;], dtype=&#39;&lt;U7&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Category-to-indices">Category to indices<a class="anchor-link" href="#Category-to-indices">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cates</span><span class="o">.</span><span class="n">c2i</span><span class="p">[</span><span class="n">labels</span><span class="p">[:</span><span class="mi">20</span><span class="p">]]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([12,  3,  3, 46, 35,  9, 21,  4, 10, 14, 39, 17, 23,  8,  1,  1, 42,
       45, 46,  8])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Using vectorized function</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">):</span>
    <span class="n">indices_generated</span> <span class="o">=</span> <span class="n">cates</span><span class="o">.</span><span class="n">c2i</span><span class="p">[</span><span class="n">labels</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 59.2 ms, sys: 2.86 ms, total: 62.1 ms
Wall time: 63.4 ms
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Using the original python function</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">%%time</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">200</span><span class="p">):</span>
    <span class="n">indices_generated2</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">cates</span><span class="o">.</span><span class="n">c2i</span><span class="o">.</span><span class="n">get_int</span><span class="p">(</span><span class="n">l</span><span class="p">)</span> <span class="k">for</span> <span class="n">l</span> <span class="ow">in</span> <span class="n">labels</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>CPU times: user 104 ms, sys: 2.56 ms, total: 106 ms
Wall time: 136 ms
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Transform forward and backward and check fidelity</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="p">(</span><span class="n">cates</span><span class="o">.</span><span class="n">c2i</span><span class="p">[</span><span class="n">labels</span><span class="p">]</span><span class="o">==</span><span class="n">test_c</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>1.0</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="With-missing-tokens">With missing tokens<a class="anchor-link" href="#With-missing-tokens">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can set pad_mst to True to manage missing token</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nt</span> <span class="o">=</span> <span class="n">Category</span><span class="p">(</span><span class="s2">&quot;ATCG&quot;</span><span class="p">,</span> <span class="n">pad_mst</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Categories-to-indices">Categories to indices<a class="anchor-link" href="#Categories-to-indices">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nt</span><span class="o">.</span><span class="n">c2i</span><span class="p">[</span><span class="nb">list</span><span class="p">(</span><span class="s2">&quot;AAACCTTATTGCAGCOAAT&quot;</span><span class="p">)]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([1, 1, 1, 3, 3, 2, 2, 1, 2, 2, 4, 3, 1, 4, 3, 0, 1, 1, 2])</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Indices-to-categories">Indices to categories<a class="anchor-link" href="#Indices-to-categories">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nt</span><span class="o">.</span><span class="n">i2c</span><span class="p">[[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]]</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>array([&#39;A&#39;, &#39;A&#39;, &#39;A&#39;, &#39;C&#39;, &#39;C&#39;, &#39;T&#39;, &#39;T&#39;, &#39;T&#39;, &#39;T&#39;, &#39;G&#39;, &#39;C&#39;, &#39;A&#39;, &#39;G&#39;,
       &#39;C&#39;, &#39;[MST]&#39;, &#39;A&#39;, &#39;A&#39;, &#39;T&#39;], dtype=&#39;&lt;U5&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Data-save-and-load">Data save and load<a class="anchor-link" href="#Data-save-and-load">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Save-categories">Save categories<a class="anchor-link" href="#Save-categories">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">nt</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="s2">&quot;atcg.json&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Load-categories">Load categories<a class="anchor-link" href="#Load-categories">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cm</span> <span class="o">=</span> <span class="n">Category</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;atcg.json&quot;</span><span class="p">)</span>
<span class="n">cm</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>Category Manager with 5</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}
</div>
 

