---

title: Title

keywords: fastai
sidebar: home_sidebar

summary: "summary"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/forgebox_test.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    {% raw %}
        
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="FrogeBox-Pipe">FrogeBox Pipe<a class="anchor-link" href="#FrogeBox-Pipe">&#182;</a></h1><h3 id="A-pandas-dataframe-pipeline">A pandas dataframe pipeline<a class="anchor-link" href="#A-pandas-dataframe-pipeline">&#182;</a></h3><p>This is a tutorial about tabular data processing pipeline</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>
<span class="kn">import</span> <span class="nn">os</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Sample dataset: <a href="https://www.kaggle.com/dgomonov/new-york-city-airbnb-open-data">New York City Airbnb Open Data</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">HOME</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">environ</span><span class="p">[</span><span class="s2">&quot;HOME&quot;</span><span class="p">])</span><span class="o">/</span><span class="s2">&quot;data&quot;</span>
<span class="n">DATA</span> <span class="o">=</span> <span class="n">HOME</span><span class="o">/</span><span class="s2">&quot;AB_NYC_2019.csv&quot;</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>A preview on data set</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">DATA</span><span class="p">)</span>

<span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>host_id</th>
      <th>host_name</th>
      <th>neighbourhood_group</th>
      <th>neighbourhood</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>room_type</th>
      <th>price</th>
      <th>minimum_nights</th>
      <th>number_of_reviews</th>
      <th>last_review</th>
      <th>reviews_per_month</th>
      <th>calculated_host_listings_count</th>
      <th>availability_365</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2539</td>
      <td>Clean &amp; quiet apt home by the park</td>
      <td>2787</td>
      <td>John</td>
      <td>Brooklyn</td>
      <td>Kensington</td>
      <td>40.64749</td>
      <td>-73.97237</td>
      <td>Private room</td>
      <td>149</td>
      <td>1</td>
      <td>9</td>
      <td>2018-10-19</td>
      <td>0.21</td>
      <td>6</td>
      <td>365</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2595</td>
      <td>Skylit Midtown Castle</td>
      <td>2845</td>
      <td>Jennifer</td>
      <td>Manhattan</td>
      <td>Midtown</td>
      <td>40.75362</td>
      <td>-73.98377</td>
      <td>Entire home/apt</td>
      <td>225</td>
      <td>1</td>
      <td>45</td>
      <td>2019-05-21</td>
      <td>0.38</td>
      <td>2</td>
      <td>355</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3647</td>
      <td>THE VILLAGE OF HARLEM....NEW YORK !</td>
      <td>4632</td>
      <td>Elisabeth</td>
      <td>Manhattan</td>
      <td>Harlem</td>
      <td>40.80902</td>
      <td>-73.94190</td>
      <td>Private room</td>
      <td>150</td>
      <td>3</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1</td>
      <td>365</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3831</td>
      <td>Cozy Entire Floor of Brownstone</td>
      <td>4869</td>
      <td>LisaRoxanne</td>
      <td>Brooklyn</td>
      <td>Clinton Hill</td>
      <td>40.68514</td>
      <td>-73.95976</td>
      <td>Entire home/apt</td>
      <td>89</td>
      <td>1</td>
      <td>270</td>
      <td>2019-07-05</td>
      <td>4.64</td>
      <td>1</td>
      <td>194</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5022</td>
      <td>Entire Apt: Spacious Studio/Loft by central park</td>
      <td>7192</td>
      <td>Laura</td>
      <td>Manhattan</td>
      <td>East Harlem</td>
      <td>40.79851</td>
      <td>-73.94399</td>
      <td>Entire home/apt</td>
      <td>80</td>
      <td>10</td>
      <td>9</td>
      <td>2018-11-19</td>
      <td>0.10</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="DataFrame-Pipeline">DataFrame Pipeline<a class="anchor-link" href="#DataFrame-Pipeline">&#182;</a></h3>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">forgebox.pipe</span> <span class="kn">import</span> <span class="n">Node</span><span class="p">,</span><span class="n">colEdge</span>
<span class="kn">from</span> <span class="nn">forgebox.pipe.edge</span> <span class="kn">import</span> <span class="n">capMinMaxEdge</span><span class="p">,</span><span class="n">eng_twt_tk</span><span class="p">,</span><span class="n">fillNaEdge</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Start node, a pandas dataframe</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">start_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h4 id="Column-edges">Column edges<a class="anchor-link" href="#Column-edges">&#182;</a></h4><p><code>edge</code> defines a method of processing data.</p>
<ul>
<li>colEdge and its sub-class process column</li>
<li>frameEdge and its cub_class process a dataframe (multiple columns)</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">cap_minmax_edge</span> <span class="o">=</span> <span class="n">capMinMaxEdge</span><span class="p">(</span><span class="n">max_</span> <span class="o">=</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">fill_na_edge</span> <span class="o">=</span> <span class="n">fillNaEdge</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Nodes/Edges-relationship-mapping">Nodes/Edges relationship mapping<a class="anchor-link" href="#Nodes/Edges-relationship-mapping">&#182;</a></h3><ul>
<li>node1 ==edge1==&gt; node2 : <ul>
<li><div class="highlight"><pre><span></span><span class="n">node2</span> <span class="o">=</span> <span class="n">node1</span> <span class="o">|</span> <span class="n">edge1</span>
</pre></div>
</li>
</ul>
</li>
<li>node1 ==edge1==&gt;edge2==&gt; node2 : <ul>
<li><div class="highlight"><pre><span></span><span class="n">node2</span> <span class="o">=</span> <span class="n">node1</span> <span class="o">|</span> <span class="n">edge1</span> <span class="o">|</span> <span class="n">edge2</span>
</pre></div>
</li>
<li><div class="highlight"><pre><span></span><span class="n">node3</span> <span class="o">=</span> <span class="n">node2</span> <span class="o">|</span> <span class="n">edge3</span>
</pre></div>
</li>
</ul>
</li>
</ul>
<h3 id="Relationship-mapping-with-columns-specified">Relationship mapping with <strong>columns specified</strong><a class="anchor-link" href="#Relationship-mapping-with-columns-specified">&#182;</a></h3><ul>
<li>Specifying 1 column<ul>
<li><div class="highlight"><pre><span></span><span class="n">node2</span> <span class="o">=</span> <span class="n">node1</span> <span class="o">|</span> <span class="n">edge1</span><span class="o">%</span><span class="s2">&quot;column_1&quot;</span>
</pre></div>
</li>
</ul>
</li>
<li>Specifying multiple columns<ul>
<li><div class="highlight"><pre><span></span><span class="n">node2</span> <span class="o">=</span> <span class="n">node1</span> <span class="o">|</span> <span class="n">edge1</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;column_2&quot;</span><span class="p">,</span><span class="s2">&quot;column_3&quot;</span><span class="p">,</span><span class="s2">&quot;column_4&quot;</span><span class="p">]</span>
</pre></div>
</li>
</ul>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Setting the node/edge pipeline</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># clip minmax value on 1 column</span>
<span class="c1"># fill na to &quot;&quot;, on 2 columns</span>
<span class="c1"># tokenize, on 2 columns</span>
<span class="n">end_node</span> <span class="o">=</span> <span class="n">start_node</span><span class="o">|</span><span class="n">cap_minmax_edge</span> <span class="o">%</span><span class="s2">&quot;number_of_reviews&quot;</span>\
                    <span class="o">|</span><span class="n">fill_na_edge</span> <span class="o">*</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;room_type&quot;</span><span class="p">]</span>\
                    <span class="o">|</span><span class="n">eng_twt_tk</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;room_type&quot;</span><span class="p">]</span>   
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Print out the pipeline layout</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">end_node</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;forge pipeline node&gt;
	|cap min:None max:100
	|fillna_
	|En Tokenization</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Excute the processing</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">end_df</span> <span class="o">=</span> <span class="n">end_node</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[df edge]:cap min:None max:100
[df edge]:fillna_
[df edge]:En Tokenization
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Checking the processed data</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">end_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>host_id</th>
      <th>host_name</th>
      <th>neighbourhood_group</th>
      <th>neighbourhood</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>room_type</th>
      <th>price</th>
      <th>minimum_nights</th>
      <th>number_of_reviews</th>
      <th>last_review</th>
      <th>reviews_per_month</th>
      <th>calculated_host_listings_count</th>
      <th>availability_365</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2539</td>
      <td>[Clean, &amp;, quiet, apt, home, by, the, park]</td>
      <td>2787</td>
      <td>John</td>
      <td>Brooklyn</td>
      <td>Kensington</td>
      <td>40.64749</td>
      <td>-73.97237</td>
      <td>[Private, room]</td>
      <td>149</td>
      <td>1</td>
      <td>9</td>
      <td>2018-10-19</td>
      <td>0.21</td>
      <td>6</td>
      <td>365</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2595</td>
      <td>[Skylit, Midtown, Castle]</td>
      <td>2845</td>
      <td>Jennifer</td>
      <td>Manhattan</td>
      <td>Midtown</td>
      <td>40.75362</td>
      <td>-73.98377</td>
      <td>[Entire, home, /, apt]</td>
      <td>225</td>
      <td>1</td>
      <td>45</td>
      <td>2019-05-21</td>
      <td>0.38</td>
      <td>2</td>
      <td>355</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3647</td>
      <td>[THE, VILLAGE, OF, HARLEM, ..., NEW, YORK, !]</td>
      <td>4632</td>
      <td>Elisabeth</td>
      <td>Manhattan</td>
      <td>Harlem</td>
      <td>40.80902</td>
      <td>-73.94190</td>
      <td>[Private, room]</td>
      <td>150</td>
      <td>3</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1</td>
      <td>365</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3831</td>
      <td>[Cozy, Entire, Floor, of, Brownstone]</td>
      <td>4869</td>
      <td>LisaRoxanne</td>
      <td>Brooklyn</td>
      <td>Clinton Hill</td>
      <td>40.68514</td>
      <td>-73.95976</td>
      <td>[Entire, home, /, apt]</td>
      <td>89</td>
      <td>1</td>
      <td>100</td>
      <td>2019-07-05</td>
      <td>4.64</td>
      <td>1</td>
      <td>194</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5022</td>
      <td>[Entire, Apt, :, Spacious, Studio, /, Loft, by...</td>
      <td>7192</td>
      <td>Laura</td>
      <td>Manhattan</td>
      <td>East Harlem</td>
      <td>40.79851</td>
      <td>-73.94399</td>
      <td>[Entire, home, /, apt]</td>
      <td>80</td>
      <td>10</td>
      <td>9</td>
      <td>2018-11-19</td>
      <td>0.10</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Working-with-bigger-data">Working with bigger data<a class="anchor-link" href="#Working-with-bigger-data">&#182;</a></h3><p>There is often the cases when we have to deal with csv &gt; 500m in size or a huge sql table.</p>
<p>Gladely, pandas offer a chunksize solution, so we can process huge structured data in batch(defined by the chunk size)</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">forgebox.pipe</span> <span class="kn">import</span> <span class="n">chunkNode</span>
<span class="kn">from</span> <span class="nn">forgebox.pipe.edge</span> <span class="kn">import</span> <span class="n">saveCSV</span><span class="p">,</span> <span class="n">saveSQL</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><code>saveCSV</code> : saving file could be a part of the pipeline, we can follow that edge by <code>saveSQL</code> if we like</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">start_node</span> <span class="o">=</span> <span class="n">chunkNode</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">DATA</span><span class="p">,</span> <span class="n">chunksize</span><span class="o">=</span><span class="mi">5000</span><span class="p">),</span> <span class="n">verbose</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="n">end_node</span> <span class="o">=</span> <span class="n">start_node</span><span class="o">|</span><span class="n">cap_minmax_edge</span> <span class="o">%</span><span class="s2">&quot;number_of_reviews&quot;</span>\
                    <span class="o">|</span><span class="n">fill_na_edge</span> <span class="o">*</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;room_type&quot;</span><span class="p">]</span>\
                    <span class="o">|</span><span class="n">eng_twt_tk</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;room_type&quot;</span><span class="p">]</span>\
                    <span class="o">|</span><span class="n">saveCSV</span><span class="p">(</span><span class="n">HOME</span><span class="o">/</span><span class="s2">&quot;nyc_processed.csv&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Pipeline layout summary</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">end_node</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;forge pipeline node&gt;
	|cap min:None max:100
	|fillna_
	|En Tokenization
	|save to csv</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>Notice</strong></p>
<ul>
<li><code>run</code> function that <ul>
<li>start with a chunkNode has <strong>no return</strong>, </li>
<li>start with a Node will ruturn the <strong>result dataframe</strong>. </li>
</ul>
</li>
<li>This feature is purposefully designed, assuming the result data could also be huge and not suitable to remain its entirety in RAM.</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Excute the processing， if you are annoyed by the verbosity, set <code>verbose=0</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">end_node</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[df edge]:cap min:None max:100
[df edge]:fillna_
[df edge]:En Tokenization
[df edge]:save to csv
[df edge]:cap min:None max:100
[df edge]:fillna_
[df edge]:En Tokenization
[df edge]:save to csv
[df edge]:cap min:None max:100
[df edge]:fillna_
[df edge]:En Tokenization
[df edge]:save to csv
[df edge]:cap min:None max:100
[df edge]:fillna_
[df edge]:En Tokenization
[df edge]:save to csv
[df edge]:cap min:None max:100
[df edge]:fillna_
[df edge]:En Tokenization
[df edge]:save to csv
[df edge]:cap min:None max:100
[df edge]:fillna_
[df edge]:En Tokenization
[df edge]:save to csv
[df edge]:cap min:None max:100
[df edge]:fillna_
[df edge]:En Tokenization
[df edge]:save to csv
[df edge]:cap min:None max:100
[df edge]:fillna_
[df edge]:En Tokenization
[df edge]:save to csv
[df edge]:cap min:None max:100
[df edge]:fillna_
[df edge]:En Tokenization
[df edge]:save to csv
[df edge]:cap min:None max:100
[df edge]:fillna_
[df edge]:En Tokenization
[df edge]:save to csv
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="o">!</span>head -n3 <span class="o">{</span>HOME/<span class="s2">&quot;nyc_processed.csv&quot;</span><span class="o">}</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>0	2539	[&#39;Clean&#39;, &#39;&amp;&#39;, &#39;quiet&#39;, &#39;apt&#39;, &#39;home&#39;, &#39;by&#39;, &#39;the&#39;, &#39;park&#39;]	2787	John	Brooklyn	Kensington	40.647490000000005	-73.97237	[&#39;Private&#39;, &#39;room&#39;]	149	1	9	2018-10-19	0.21	6	365
1	2595	[&#39;Skylit&#39;, &#39;Midtown&#39;, &#39;Castle&#39;]	2845	Jennifer	Manhattan	Midtown	40.75362	-73.98376999999999	[&#39;Entire&#39;, &#39;home&#39;, &#39;/&#39;, &#39;apt&#39;]	225	1	45	2019-05-21	0.38	2	355
2	3647	[&#39;THE&#39;, &#39;VILLAGE&#39;, &#39;OF&#39;, &#39;HARLEM&#39;, &#39;...&#39;, &#39;NEW&#39;, &#39;YORK&#39;, &#39;!&#39;]	4632	Elisabeth	Manhattan	Harlem	40.809020000000004	-73.9419	[&#39;Private&#39;, &#39;room&#39;]	150	3	0			1	365
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Define-a-new-edge">Define a new edge<a class="anchor-link" href="#Define-a-new-edge">&#182;</a></h3><p>Create a new edge</p>
<p>Define the processing function with the <code>define</code> decorator.</p>
<ul>
<li>col is a pandas data series, the concept of <code>column</code> in pandas</li>
<li>In this case we use the <code>apply</code> function of data series, any decorated function would work as long as it return another data series</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">lower_case</span> <span class="o">=</span> <span class="n">colEdge</span><span class="p">(</span><span class="s2">&quot;lower case&quot;</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">lowerList</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">)</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">x</span><span class="p">)</span>

<span class="nd">@lower_case</span><span class="o">.</span><span class="n">define</span>
<span class="k">def</span> <span class="nf">lower</span><span class="p">(</span><span class="n">col</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">col</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">lowerList</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># The DIYed edge will work on columns &quot;name&quot; and &quot;room_type&quot; after tokenization</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">DATA</span><span class="p">)</span>
<span class="n">start_node</span> <span class="o">=</span> <span class="n">Node</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="n">end_node</span> <span class="o">=</span> <span class="n">start_node</span><span class="o">|</span><span class="n">cap_minmax_edge</span> <span class="o">%</span><span class="s2">&quot;number_of_reviews&quot;</span>\
                    <span class="o">|</span><span class="n">fill_na_edge</span> <span class="o">*</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;room_type&quot;</span><span class="p">]</span>\
                    <span class="o">|</span><span class="n">eng_twt_tk</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;room_type&quot;</span><span class="p">]</span>\
                    <span class="o">|</span><span class="n">lower_case</span><span class="o">*</span><span class="p">[</span><span class="s2">&quot;name&quot;</span><span class="p">,</span><span class="s2">&quot;room_type&quot;</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">end_node</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;forge pipeline node&gt;
	|cap min:None max:100
	|fillna_
	|En Tokenization
	|lower case</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">end_df</span> <span class="o">=</span> <span class="n">end_node</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
<span class="n">end_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>[df edge]:cap min:None max:100
[df edge]:fillna_
[df edge]:En Tokenization
[df edge]:lower case
</pre>
</div>
</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>name</th>
      <th>host_id</th>
      <th>host_name</th>
      <th>neighbourhood_group</th>
      <th>neighbourhood</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>room_type</th>
      <th>price</th>
      <th>minimum_nights</th>
      <th>number_of_reviews</th>
      <th>last_review</th>
      <th>reviews_per_month</th>
      <th>calculated_host_listings_count</th>
      <th>availability_365</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2539</td>
      <td>[clean, &amp;, quiet, apt, home, by, the, park]</td>
      <td>2787</td>
      <td>John</td>
      <td>Brooklyn</td>
      <td>Kensington</td>
      <td>40.64749</td>
      <td>-73.97237</td>
      <td>[private, room]</td>
      <td>149</td>
      <td>1</td>
      <td>9</td>
      <td>2018-10-19</td>
      <td>0.21</td>
      <td>6</td>
      <td>365</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2595</td>
      <td>[skylit, midtown, castle]</td>
      <td>2845</td>
      <td>Jennifer</td>
      <td>Manhattan</td>
      <td>Midtown</td>
      <td>40.75362</td>
      <td>-73.98377</td>
      <td>[entire, home, /, apt]</td>
      <td>225</td>
      <td>1</td>
      <td>45</td>
      <td>2019-05-21</td>
      <td>0.38</td>
      <td>2</td>
      <td>355</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3647</td>
      <td>[the, village, of, harlem, ..., new, york, !]</td>
      <td>4632</td>
      <td>Elisabeth</td>
      <td>Manhattan</td>
      <td>Harlem</td>
      <td>40.80902</td>
      <td>-73.94190</td>
      <td>[private, room]</td>
      <td>150</td>
      <td>3</td>
      <td>0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1</td>
      <td>365</td>
    </tr>
    <tr>
      <th>3</th>
      <td>3831</td>
      <td>[cozy, entire, floor, of, brownstone]</td>
      <td>4869</td>
      <td>LisaRoxanne</td>
      <td>Brooklyn</td>
      <td>Clinton Hill</td>
      <td>40.68514</td>
      <td>-73.95976</td>
      <td>[entire, home, /, apt]</td>
      <td>89</td>
      <td>1</td>
      <td>100</td>
      <td>2019-07-05</td>
      <td>4.64</td>
      <td>1</td>
      <td>194</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5022</td>
      <td>[entire, apt, :, spacious, studio, /, loft, by...</td>
      <td>7192</td>
      <td>Laura</td>
      <td>Manhattan</td>
      <td>East Harlem</td>
      <td>40.79851</td>
      <td>-73.94399</td>
      <td>[entire, home, /, apt]</td>
      <td>80</td>
      <td>10</td>
      <td>9</td>
      <td>2018-11-19</td>
      <td>0.10</td>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}
</div>
 

