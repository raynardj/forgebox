---

title: Controllable loop process

keywords: fastai
sidebar: home_sidebar

summary: "iteration with callbacks"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/10_loop.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
    {% raw %}
        
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="method4all" class="doc_header"><code>method4all</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loop.py#L14" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>method4all</code>(<strong><code>f</code></strong>)</p>
</blockquote>
<p>Use this function as a decorator,
The decorated function under Loop class can be used on outer layer</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="StorageCore" class="doc_header"><code>class</code> <code>StorageCore</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loop.py#L22" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>StorageCore</code>(<strong><code>start_layer</code></strong>)</p>
</blockquote>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Loop" class="doc_header"><code>class</code> <code>Loop</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loop.py#L58" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Loop</code>(<strong><code>iterable</code></strong>=<em><code>[]</code></em>, <strong><code>name</code></strong>=<em><code>None</code></em>)</p>
</blockquote>
<p>Basic loop class</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Loop-in-loop-concept">Loop-in-loop concept<a class="anchor-link" href="#Loop-in-loop-concept">&#182;</a></h2><p>Loop and its inheriting descendants runs on iterable, incuding other <code>[`Loop`](/forgebox/loop#Loop)</code></p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="n">Loop</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">),</span><span class="n">name</span> <span class="o">=</span> <span class="s2">&quot;hahahha&quot;</span><span class="p">)</span>
<span class="n">l</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>layer:hahahha</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">Printer</span><span class="p">(</span><span class="n">Loop</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;epoch_</span><span class="si">{self.core.epoch}</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">f</span><span class="s2">&quot;i_</span><span class="si">{self.core.i}</span><span class="s2">&quot;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">element</span><span class="p">)</span>
        
<span class="n">l2</span> <span class="o">=</span> <span class="n">Printer</span><span class="p">(</span><span class="n">l</span><span class="p">)</span>
<span class="n">l2</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>epoch_0	i_0	5
epoch_0	i_1	6
epoch_0	i_2	7
epoch_0	i_3	8
epoch_0	i_4	9
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Progress-bar">Progress bar<a class="anchor-link" href="#Progress-bar">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="ProgressBar" class="doc_header"><code>class</code> <code>ProgressBar</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loop.py#L130" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>ProgressBar</code>(<strong><code>iterable</code></strong>=<em><code>[]</code></em>, <strong><code>jupyter</code></strong>=<em><code>True</code></em>) :: <a href="/forgebox/loop#Loop"><code>Loop</code></a></p>
</blockquote>
<p>Basic loop class</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">ProgressBar</span><span class="p">(</span><span class="n">Loop</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)),</span><span class="n">jupyter</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="Application-upon-progress-bar">Application upon progress bar<a class="anchor-link" href="#Application-upon-progress-bar">&#182;</a></h3><p>The function <code>pgbar_data</code> is decorated under <code>[`method4all`](/forgebox/loop#method4all)</code>, hence the function can be used else where</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">datetime</span> <span class="k">import</span> <span class="n">datetime</span>
<span class="k">class</span> <span class="nc">Application</span><span class="p">(</span><span class="n">Loop</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># create some data</span>
        <span class="n">loop_data</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">epoch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">epoch</span><span class="p">,</span><span class="n">i</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">i</span><span class="p">,</span>
                         <span class="n">val</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">,)</span>
        <span class="c1"># update data to progress bar</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pgbar_data</span><span class="p">(</span><span class="n">loop_data</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pgbar_description</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">)))</span>

<span class="n">l3</span> <span class="o">=</span> <span class="n">Application</span><span class="p">(</span><span class="n">ProgressBar</span><span class="p">(</span><span class="n">Loop</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span><span class="mi">10</span><span class="p">)),</span><span class="n">jupyter</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
<span class="n">l3</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Print-out-the-summary-of-the-loop">Print out the summary of the loop<a class="anchor-link" href="#Print-out-the-summary-of-the-loop">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">l3</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Loop layer Application summary:
==================================================
🍰layer0.0	layer:Loop
--------------------------------------------------
🍰layer1.0	layer:Progressb Bar
	[🐍Function:pgbar_data]	
        update progress bar with python dictionary
        data: python dictionary
        
	 (&#39;self&#39;, &#39;data&#39;, &#39;t&#39;, &#39;set_postfix&#39;)
	...................................
	[🐍Function:pgbar_description]	
        update progress bar prefix with text string
        
	 (&#39;self&#39;, &#39;text&#39;, &#39;t&#39;, &#39;set_description_str&#39;)
	...................................
--------------------------------------------------
🍰layer2.0	layer:Application
--------------------------------------------------
==================================================

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">l3</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Event">Event<a class="anchor-link" href="#Event">&#182;</a></h2><p>Event allows add-hoc callbacks to be created</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">

</div>
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="Event" class="doc_header"><code>class</code> <code>Event</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/loop.py#L175" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>Event</code>(<strong><code>iterable</code></strong>=<em><code>[]</code></em>, <strong><code>event_name</code></strong>=<em><code>None</code></em>, <strong><code>cbs</code></strong>=<em><code>[]</code></em>) :: <a href="/forgebox/loop#Loop"><code>Loop</code></a></p>
</blockquote>
<p>An event is the landmark with in 1 iteration</p>

</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">class</span> <span class="nc">ToString</span><span class="p">(</span><span class="n">Loop</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">element</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;variable_</span><span class="si">{self.i}</span><span class="s2">&quot;</span>

<span class="k">class</span> <span class="nc">AfterToString</span><span class="p">(</span><span class="n">Event</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">iterable</span><span class="o">=</span><span class="p">[],</span><span class="n">cbs</span><span class="o">=</span><span class="p">[]):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">iterable</span><span class="o">=</span><span class="n">iterable</span><span class="p">,</span><span class="n">event_name</span><span class="o">=</span><span class="s2">&quot;after_to_string&quot;</span><span class="p">,</span><span class="n">cbs</span><span class="o">=</span><span class="n">cbs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_frame</span><span class="p">(</span><span class="n">iterable</span><span class="p">):</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="n">ProgressBar</span><span class="p">(</span><span class="n">Loop</span><span class="p">(</span><span class="n">iterable</span><span class="p">,</span><span class="s2">&quot;base&quot;</span><span class="p">))</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="n">ToString</span><span class="p">(</span><span class="n">l1</span><span class="p">,)</span>
    <span class="n">l3</span> <span class="o">=</span> <span class="n">AfterToString</span><span class="p">(</span><span class="n">l2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">l3</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">l</span> <span class="o">=</span> <span class="n">get_frame</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># you can use this &quot;on&quot; syntax</span>
<span class="nd">@l</span><span class="o">.</span><span class="n">after_to_string</span><span class="o">.</span><span class="n">on</span>
<span class="k">def</span> <span class="nf">trim</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">element</span> <span class="o">=</span> <span class="n">f</span><span class="s2">&quot;Var_</span><span class="si">{self.element}</span><span class="s2">&quot;</span>
    
<span class="c1"># or this syntax</span>
<span class="nd">@l</span><span class="o">.</span><span class="n">set_after_to_string</span>
<span class="k">def</span> <span class="nf">update</span><span class="p">(</span><span class="bp">self</span><span class="p">,):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pgbar_description</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">element</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">l</span><span class="o">.</span><span class="n">summary</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>Loop layer after_to_string summary:
==================================================
🍰layer0.0	layer:base
--------------------------------------------------
🍰layer1.0	layer:Progressb Bar
	[🐍Function:pgbar_data]	
        update progress bar with python dictionary
        data: python dictionary
        
	 (&#39;self&#39;, &#39;data&#39;, &#39;t&#39;, &#39;set_postfix&#39;)
	...................................
	[🐍Function:pgbar_description]	
        update progress bar prefix with text string
        
	 (&#39;self&#39;, &#39;text&#39;, &#39;t&#39;, &#39;set_description_str&#39;)
	...................................
--------------------------------------------------
🍰layer2.0	layer:ToString
--------------------------------------------------
🍰layer3.0	layer:after_to_string
	[🐍Function:on_after_to_string]	
            Excute callback for event:after_to_string
        
	 (&#39;self&#39;, &#39;__call__&#39;)
	...................................
	[🐍Function:set_after_to_string]	
            Append new callback for event:after_to_string
            Use this function as decorator
        
	 (&#39;self&#39;, &#39;f&#39;, &#39;on&#39;)
	...................................
--------------------------------------------------
==================================================

</pre>
</div>
</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">code</span><span class="o">=</span> <span class="n">l</span><span class="o">.</span><span class="n">pgbar_data</span><span class="o">.</span><span class="vm">__code__</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">code</span><span class="o">.</span><span class="n">co_varnames</span><span class="o">+</span><span class="n">code</span><span class="o">.</span><span class="n">co_names</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(&#39;self&#39;, &#39;data&#39;, &#39;t&#39;, &#39;set_postfix&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">code</span><span class="o">.</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>2</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">code</span><span class="o">.</span><span class="n">co_varnames</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(&#39;self&#39;, &#39;f&#39;)</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">l</span><span class="o">.</span><span class="n">run</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}
</div>
 

