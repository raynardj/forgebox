---

title: Data parts for hf transformers


keywords: fastai
sidebar: home_sidebar



nb_path: "nbs/70_hf_transformer_data.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: nbs/70_hf_transformer_data.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Process-IOBES-files">Process IOBES files<a class="anchor-link" href="#Process-IOBES-files"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="convert_iob2_file_to_iobes" class="doc_header"><code>convert_iob2_file_to_iobes</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/hf/data.py#L11" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>convert_iob2_file_to_iobes</code>(<strong><code>file_path</code></strong>, <strong><code>result_path</code></strong>)</p>
</blockquote>
<p>Convert IOB2 file to IOBES</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h4 id="conbine_iobes_file" class="doc_header"><code>conbine_iobes_file</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/hf/data.py#L30" class="source_link" style="float:right">[source]</a></h4><blockquote><p><code>conbine_iobes_file</code>(<strong><code>file_paths</code></strong>:<code>List</code>[<code>Path</code>], <strong><code>new_file_path</code></strong>:<code>Path</code>)</p>
</blockquote>
<p>Conbine from multiple IOBES files
    into IOBES files</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Dataset">Dataset<a class="anchor-link" href="#Dataset"> </a></h2>
</div>
</div>
</div>
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_markdown rendered_html output_subarea ">
<h2 id="IOBES" class="doc_header"><code>class</code> <code>IOBES</code><a href="https://github.com/raynardj/forgebox/tree/master/forgebox/hf/data.py#L45" class="source_link" style="float:right">[source]</a></h2><blockquote><p><code>IOBES</code>(<strong>*<code>args</code></strong>, <strong>**<code>kwds</code></strong>) :: <code>Dataset</code></p>
</blockquote>
<p>Load iobes file for NER training task</p>

</div>

</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">transformers</span> <span class="kn">import</span> <span class="n">AutoTokenizer</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">tokenizer</span> <span class="o">=</span> <span class="n">AutoTokenizer</span><span class="o">.</span><span class="n">from_pretrained</span><span class="p">(</span><span class="s2">&quot;raynardj/roberta-pubmed&quot;</span><span class="p">,</span> <span class="n">add_prefix_space</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset</span> <span class="o">=</span> <span class="n">IOBES</span><span class="p">(</span><span class="s2">&quot;/Users/xiaochen.zhang/data/valid.iobes&quot;</span><span class="p">,</span> <span class="n">tokenizer</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">for</span> <span class="n">w</span><span class="p">,</span><span class="n">l</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">dataset</span><span class="p">[</span><span class="mi">2</span><span class="p">]):</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">w</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">l</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>in-O
blood-O
;-O
content-O
of-O
cAMP-O
was-O
also-O
decreased-O
in-O
lymphocytes-O
by-O
33-O
%-O
.-O
At-O
the-O
same-O
time-O
,-O
total-O
content-O
of-O
T-cell_type
lymphocytes-cell_type
was-O
decreased-O
1.5-fold-O
in-O
peripheric-O
blood-O
.-O
Treatment-O
with-O
I-hydroxyvitamin-O
D3-O
(-O
1-1.5-O
mg-O
daily-O
,-O
within-O
4-O
weeks-O
)-O
led-O
to-O
normalization-O
of-O
total-O
and-O
ionized-O
form-O
of-O
Ca2+-O
and-O
of-O
25-O
(-O
OH-O
)-O
D-O
,-O
but-O
did-O
not-O
affect-O
the-O
PTH-O
content-O
in-O
blood-O
.-O
Concentration-O
of-O
the-O
receptors-protein
to-O
1.25-O
(-O
OH-O
)-O
2D3-O
was-O
elevated-O
up-O
to-O
39.7-O
fmole/mg-O
after-O
I-O
week-O
of-O
the-O
treatment-O
,-O
whereas-O
it-O
was-O
decreased-O
to-O
the-O
initial-O
level-O
24.8-O
fmole/mg-O
within-O
4-O
weeks-O
;-O
simultaneous-O
alteration-O
in-O
</pre>
</div>
</div>

</div>
</div>

</div>
    {% endraw %}

    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dataset</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>{&#39;input_ids&#39;: tensor([[   19,  3741,  2603,  ...,  1417,  2617, 11576],
        [ 4590,  2156,   255,  ...,   405,  1182,  6608],
        [ 6214, 25683,  3809,  ...,    11,     5,  8151],
        ...,
        [13998, 25326,  2413,  ...,     5,  2199,    21],
        [11299,   705, 24811,  ...,   134,  1589,  2032],
        [ 5804,   924,    14,  ...,   366,  1168,     9]]), &#39;attention_mask&#39;: tensor([[1, 1, 1,  ..., 1, 1, 1],
        [1, 1, 1,  ..., 1, 1, 1],
        [1, 1, 1,  ..., 1, 1, 1],
        ...,
        [1, 1, 1,  ..., 1, 1, 1],
        [1, 1, 1,  ..., 1, 1, 1],
        [1, 1, 1,  ..., 1, 1, 1]]), &#39;offset_mapping&#39;: tensor([[[ 1,  4],
         [ 1,  2],
         [ 2,  5],
         ...,
         [ 3,  5],
         [ 5,  8],
         [ 1,  6]],

        [[ 1,  5],
         [ 1,  1],
         [ 1,  1],
         ...,
         [ 5,  7],
         [ 7,  9],
         [ 9, 14]],

        [[ 1,  5],
         [ 5,  8],
         [ 8, 10],
         ...,
         [ 1,  2],
         [ 1,  3],
         [ 1, 10]],

        ...,

        [[ 1,  5],
         [ 5,  8],
         [ 8, 10],
         ...,
         [ 1,  3],
         [ 1,  7],
         [ 1,  3]],

        [[ 1,  5],
         [ 5,  6],
         [ 6, 10],
         ...,
         [ 2,  3],
         [ 1,  1],
         [ 1,  2]],

        [[ 1,  7],
         [ 1,  5],
         [ 1,  4],
         ...,
         [ 3,  5],
         [ 5,  7],
         [ 1,  2]]]), &#39;labels&#39;: tensor([[0, 1, 1,  ..., 0, 0, 0],
        [2, 0, 2,  ..., 0, 0, 0],
        [0, 0, 0,  ..., 0, 0, 0],
        ...,
        [1, 1, 1,  ..., 0, 0, 0],
        [0, 0, 0,  ..., 2, 0, 2],
        [0, 0, 0,  ..., 0, 0, 0]])}</pre>
</div>

</div>

</div>
</div>

</div>
    {% endraw %}

</div>
 

